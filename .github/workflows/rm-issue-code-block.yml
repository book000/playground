name: Remove issue code block

on:
  workflow_dispatch:
  issues:
    types: [opened]

jobs:
  rm-code-block:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout develop
        uses: actions/checkout@v3

      - name: Fetch issue comment
        working-directory: ..
        run: |
          gh issue view ${{ github.event.issue.number }} -R "$GITHUB_REPOSITORY" --json body | jq -r .body > message.txt
          cat message.txt

      - name: Replace
        working-directory: ..
        run: |
          node -e "var fs=require('fs');str=fs.readFileSync('message.txt').toString();fs.writeFileSync('message.txt',str.replace(/\`\`\`markdown\n([\s\S]+?)\n\`\`\`\n/g,'\$1'));"

      - name: Fetch issue comment
        working-directory: ..
        run: |
          cat message.txt
          gh issue edit ${{ github.event.issue.number }} -R "$GITHUB_REPOSITORY" -F message.txt